# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

**项目名称：** 上海药品信息管理与查询平台（SH-Drug-Mgmt）
**架构类型：** B/S架构Web平台
**核心目标：** 连接药店、供应商、监管部门、物流公司，实现药品信息集中管理、流通追溯、库存监控、B2B模拟交易与监管可视化

## 技术栈

### 前端
- **框架：** Vue 3 + Vite
- **要求：** 兼容 Chrome 90+/Firefox 88+/Edge 90+
- **语言：** 简体中文

### 后端
- **框架：** Flask
- **数据库：** SQLite
- **认证：** JWT
- **权限控制：** RBAC

### 外部服务
- **地图服务：** 高德地图API
- **实时通信：** WebSocket（位置推送）

## 系统架构

### 核心模块
1. **企业库存管理子系统** - 药品库存登记、更新、预警
2. **B2B供求平台子系统** - 供应信息发布、查看、模拟下单
3. **流通监管子系统** - 流通数据上报、全生命周期追溯
4. **监管分析子系统** - 监管看板、合规分析报告
5. **智能调度子系统** - 药品定位、路径规划、实时监控

### 数据库设计
**12张核心表：**
- `users` - 用户表（username唯一）
- `tenants` - 租户表
- `drugs` - 药品信息表
- `inventory_items` - 库存项表（quantity≥0）
- `circulation_records` - 流通记录表
- `supply_info` - 供应信息表
- `orders` - 订单表
- `logistics_records` - 物流记录表
- `roles` - 角色表
- `permissions` - 权限表
- `user_roles` - 用户角色关联表
- `role_permissions` - 角色权限关联表

## 用户角色与权限

### 用户类型
1. **药店用户** - 库存管理、下单采购
2. **供应商用户** - 供应信息管理、订单处理
3. **监管用户** - 数据监控、合规分析
4. **物流用户** - 运输状态上报、位置更新
5. **系统管理员** - 用户管理、权限配置

### 关键约束
- **租户数据隔离：** 所有数据访问必须基于租户ID校验
- **密码策略：** 最少8位，必须包含字母和数字
- **权限控制：** 基于RBAC的细粒度权限管理

## 核心功能需求

### 企业库存管理子系统

#### UC-S-001: 库存登记/更新
**必填字段：**
- 药品ID
- 批号
- 生产日期
- 有效期
- 库存数量
**约束：** 库存数量不可为负数

#### UC-S-002: 库存预警
**默认阈值：**
- 库存 < 10件
- 有效期 < 30天
**执行频率：** 每日扫描

### B2B供求平台子系统

#### UC-B-001: 发布供应信息
**必填字段：**
- 药品ID
- 可供数量
- 有效期
**默认状态：** ACTIVE

#### UC-B-002: 查看供应信息
**显示规则：** 仅显示ACTIVE且未过期的供应信息

#### UC-B-003: 管理供应信息
**约束：** 有PENDING订单时不可修改核心字段/下架

#### UC-B-004: 模拟下单
**初始状态：** PENDING

#### UC-B-005: 模拟订单管理
**状态流转：** PENDING → CONFIRMED/CANCELLED/EXPIRED_CANCELLED
**自动取消：** 24小时未确认自动取消

### 流通监管子系统

#### UC-R-001: 流通数据上报
**上报方：** 企业或物流公司
**内容：** 运输状态更新

#### UC-R-002: 药品全生命周期追溯
**输入：** 药品批号
**输出：** 完整流向信息
**响应时间：** ≤5秒

### 监管分析子系统

#### UC-A-001: 监管看板
**功能：** 多维度数据筛选
**性能：** 加载时间≤3秒

#### UC-A-002: 合规分析报告
**导出格式：** PDF/Excel
**生成时间：** ≤10秒

### 智能调度子系统

#### UC-L-001: 药品定位与就近推荐
**准确度：** 距离计算准确度≥95%

#### UC-D-001: 最优配送路径规划
**优化目标：** 比人工优化提升20%+

#### UC-L-002: 实时运输监控
**更新频率：** 位置更新延迟≤30秒

## 技术规范

### API设计
- **协议：** RESTful API
- **数据格式：** JSON
- **认证：** 所有非公开API需携带JWT Token
- **实时通信：** WebSocket用于位置推送

### 性能要求
- **页面加载：** ≤3秒
- **常规操作：** ≤2秒
- **并发支持：** 10用户并发
- **数据容量：** 支持5000+流通记录

### 质量属性
- **核心功能可用性：** ≥95%
- **认证机制：** JWT
- **授权机制：** RBAC
- **数据隔离：** 租户ID校验

## 开发规范

### 代码规范
- 使用RESTful API设计原则
- 所有API响应采用统一JSON格式
- 数据库操作使用事务保障一致性
- 关键字段建立索引优化查询性能

### 安全要求
- 密码加密存储
- JWT Token有效期管理
- API访问权限校验
- 租户数据严格隔离

### 错误处理
- 统一异常处理机制
- 友好的错误信息提示
- 完整的操作日志记录

## 开发环境设置

### 本地开发
1. **前端环境：**
   ```bash
   npm install
   npm run dev
   ```

2. **后端环境：**
   ```bash
   pip install -r requirements.txt
   python app.py
   ```

### 数据库
- **开发环境：** SQLite
- **初始化：** 执行数据库迁移脚本
- **测试数据：** 提供基础测试数据集

## 部署与运维

### 部署要求
- Web服务器（Nginx/Apache）
- WSGI服务器（Gunicorn/uWSGI）
- 数据库服务器（生产环境可使用PostgreSQL/MySQL）

### 监控指标
- 系统响应时间
- API调用成功率
- 数据库性能
- 用户活跃度

## 项目边界与约束

### 功能排除
- ❌ 真实在线支付功能
- ❌ 与国家药监局系统直连
- ❌ B2C功能（仅支持B2B）

### 业务约束
- 所有交易均为模拟性质
- 不可用于真实商业交易
- 监管数据仅供分析使用

## 优先级标准

### 优先级定义
- **高（High）：** 核心功能，必须实现
- **中（Medium）：** 重要功能，不影响核心流程
- **低（Low）：** 辅助功能，后续迭代

### 开发优先级
1. **第一优先级：** 用户管理、库存管理、B2B基础功能
2. **第二优先级：** 流通监管、数据分析
3. **第三优先级：** 智能调度、高级分析功能

## 文档与测试

### 文档要求
- API文档自动生成
- 数据库设计文档
- 用户操作手册
- 系统部署指南

### 测试要求
- 单元测试覆盖率≥80%
- 集成测试覆盖核心流程
- 性能测试验证响应时间
- 安全测试确保数据隔离

## 团队协作

### 版本控制
- 使用Git进行版本控制
- 采用分支管理策略
- 代码审查机制

### GitLab项目
- **仓库地址：** https://gitlab.com/tj-cs-swe/CS10102302-2025/group4/shanghaidrugmanagementplatform_1.git
- **项目性质：** 私有仓库
- **协作方式：** 基于Issue的任务分配和进度跟踪