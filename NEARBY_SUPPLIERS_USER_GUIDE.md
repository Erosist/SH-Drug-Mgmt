# å°±è¿‘ä¾›åº”å•†æ¨èåŠŸèƒ½ - ä½¿ç”¨æŒ‡å—

## ğŸ‰ åŠŸèƒ½å®Œæˆæ€»ç»“

å·²å®Œæˆå…¨æ ˆå®ç°çš„å°±è¿‘ä¾›åº”å•†æ¨èåŠŸèƒ½ï¼

---

## ğŸ“ å·²å®ç°çš„æ–‡ä»¶

### åç«¯ (Backend)

1. **æ ¸å¿ƒåŠŸèƒ½**
   - `backend/amap.py` - é«˜å¾·åœ°å›¾ API é›†æˆ
   - `backend/nearby.py` - REST API æ¥å£
   - `backend/models.py` - æ•°æ®æ¨¡å‹ï¼ˆå·²æ·»åŠ ç»çº¬åº¦å­—æ®µï¼‰

2. **å·¥å…·è„šæœ¬**
   - `backend/tools/batch_update_locations.py` - æ‰¹é‡æ›´æ–°åæ ‡
   - `backend/apply_coordinates_migration.py` - æ•°æ®åº“è¿ç§»å·¥å…·

3. **æµ‹è¯•**
   - `backend/scripts/test_nearby_api.py` - API æµ‹è¯•
   - `backend/test_amap.py` - é«˜å¾·åœ°å›¾åŠŸèƒ½æµ‹è¯•
   - `backend/verify_nearby_api.py` - å¿«é€ŸéªŒè¯

### å‰ç«¯ (Frontend)

1. **API å±‚**
   - `frontend/src/api/nearby.js` - åç«¯ API è°ƒç”¨å°è£…

2. **é¡µé¢ç»„ä»¶**
   - `frontend/src/views/NearbySuppliers.vue` - å°±è¿‘ä¾›åº”å•†æ¨èé¡µé¢

3. **è·¯ç”±é…ç½®**
   - `frontend/src/router/index.js` - å·²æ·»åŠ  `/nearby-suppliers` è·¯ç”±

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
python run.py
```

æœåŠ¡å°†è¿è¡Œåœ¨: http://localhost:5000

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd frontend
npm run dev
```

å‰ç«¯å°†è¿è¡Œåœ¨: http://localhost:5173

### 3. è®¿é—®åŠŸèƒ½

ç™»å½•åè®¿é—®: http://localhost:5173/nearby-suppliers

---

## ğŸ’¡ åŠŸèƒ½ç‰¹æ€§

### æœç´¢æ–¹å¼

1. **ä½¿ç”¨æˆ‘çš„ä½ç½®**
   - è‡ªåŠ¨è·å–å½“å‰ç”¨æˆ·ç§Ÿæˆ·çš„ä½ç½®ä¿¡æ¯
   - é€‚åˆå¿«é€ŸæŸ¥æ‰¾

2. **è¾“å…¥åœ°å€**
   - è¾“å…¥è¯¦ç»†åœ°å€ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºåæ ‡
   - ä¾‹å¦‚ï¼š"åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO"

3. **è¾“å…¥åæ ‡**
   - ç›´æ¥è¾“å…¥ç»çº¬åº¦
   - é€‚åˆç²¾ç¡®æœç´¢

### æœç´¢å‚æ•°

- **æœç´¢åŠå¾„**: 10km / 30km / 50km / 100km / ä¸é™åˆ¶
- **æ˜¾ç¤ºæ•°é‡**: 1-50ä¸ªä¾›åº”å•†
- **è·ç¦»è®¡ç®—**: 
  - ç›´çº¿è·ç¦»ï¼ˆå¿«é€Ÿï¼‰
  - é©¾è½¦è·ç¦»ï¼ˆç²¾ç¡®ï¼Œä½¿ç”¨é«˜å¾· APIï¼‰

### æœç´¢ç»“æœ

- æŒ‰è·ç¦»å‡åºæ’åˆ—
- æ˜¾ç¤ºä¾›åº”å•†è¯¦ç»†ä¿¡æ¯
- æä¾›è”ç³»æ–¹å¼
- è·ç¦»æ ‡ç­¾ï¼ˆè¿‘/ä¸­/è¿œï¼‰

---

## ğŸ“Š é¡µé¢åŠŸèƒ½è¯´æ˜

### æœç´¢åŒºåŸŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœç´¢æ–¹å¼é€‰æ‹©                          â”‚
â”‚ â—‹ ä½¿ç”¨æˆ‘çš„ä½ç½®                        â”‚
â”‚ â—‹ è¾“å…¥åœ°å€                            â”‚
â”‚ â—‹ è¾“å…¥åæ ‡                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢å‚æ•°                              â”‚
â”‚ - æœç´¢åŠå¾„: [50km â–¼]                 â”‚
â”‚ - æ˜¾ç¤ºæ•°é‡: [10]                      â”‚
â”‚ - è·ç¦»è®¡ç®—: [ç›´çº¿è·ç¦»/é©¾è½¦è·ç¦»]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ” æœç´¢ä¾›åº”å•†] [é‡ç½®]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»“æœåˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœç´¢ç»“æœ          æ‰¾åˆ° 5 ä¸ªä¾›åº”å•†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ’å | ä¾›åº”å•†åç§° | åœ°å€ | è·ç¦» | æ“ä½œ â”‚
â”‚  1  | ä¾›åº”å•†A    | ... | 1.3km| æŸ¥çœ‹ â”‚
â”‚  2  | ä¾›åº”å•†B    | ... | 5.2km| æŸ¥çœ‹ â”‚
â”‚  3  | ä¾›åº”å•†C    | ... | 8.5km| æŸ¥çœ‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ API ç«¯ç‚¹

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```javascript
import { nearbyApi } from '@/api/nearby'

// 1. è·å–å°±è¿‘ä¾›åº”å•†
const result = await nearbyApi.getNearbySuppliers({
  longitude: 116.470697,
  latitude: 40.000565,
  max_distance: 50000,  // 50km
  limit: 10,
  use_api: false  // ç›´çº¿è·ç¦»
})

// 2. åœ°ç†ç¼–ç 
const location = await nearbyApi.geocodeAddress(
  'åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO',
  'åŒ—äº¬å¸‚'
)

// 3. è·å–æˆ‘çš„ä½ç½®
const myLocation = await nearbyApi.getMyLocation()

// 4. æ›´æ–°æˆ‘çš„ä½ç½®
await nearbyApi.updateMyLocation({
  address: 'åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO',
  city: 'åŒ—äº¬å¸‚'
})
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šè¯åº—é‡‡è´­å‘˜å¯»æ‰¾ä¾›åº”å•†

1. ç™»å½•ç³»ç»Ÿ
2. è®¿é—®"å°±è¿‘ä¾›åº”å•†æ¨è"é¡µé¢
3. é€‰æ‹©"ä½¿ç”¨æˆ‘çš„ä½ç½®"
4. è®¾ç½®æœç´¢åŠå¾„ï¼ˆå¦‚ 30kmï¼‰
5. ç‚¹å‡»"æœç´¢ä¾›åº”å•†"
6. æŸ¥çœ‹æŒ‰è·ç¦»æ’åºçš„ä¾›åº”å•†åˆ—è¡¨
7. ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"äº†è§£ä¾›åº”å•†ä¿¡æ¯
8. ç‚¹å‡»"è”ç³»"è·å–è”ç³»æ–¹å¼

### åœºæ™¯ 2ï¼šæŒ‰åœ°å€æœç´¢

1. é€‰æ‹©"è¾“å…¥åœ°å€"
2. è¾“å…¥ï¼š"ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºé™†å®¶å˜´"
3. è¾“å…¥åŸå¸‚ï¼š"ä¸Šæµ·å¸‚"
4. è®¾ç½®æœç´¢åŠå¾„
5. ç‚¹å‡»æœç´¢

### åœºæ™¯ 3ï¼šç²¾ç¡®åæ ‡æœç´¢

1. é€‰æ‹©"è¾“å…¥åæ ‡"
2. è¾“å…¥ç»åº¦ï¼š116.470697
3. è¾“å…¥çº¬åº¦ï¼š40.000565
4. ç‚¹å‡»æœç´¢

---

## âš™ï¸ é…ç½®è¯´æ˜

### é«˜å¾·åœ°å›¾ API Key

åœ¨ `backend/config.py` ä¸­é…ç½®ï¼š

```python
AMAP_WEB_KEY = '7fdb9359ad81879b1f935cfa51dc43f0'
AMAP_REST_KEY = '143117d600102600e70696533eb39a5b'
```

### å‰ç«¯ä»£ç†é…ç½®

åœ¨ `frontend/vite.config.js` ä¸­ç¡®ä¿é…ç½®äº†ä»£ç†ï¼š

```javascript
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:5000',
        changeOrigin: true
      }
    }
  }
})
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ‰¾ä¸åˆ°ä¾›åº”å•†

**åŸå› :**
- æ•°æ®åº“ä¸­ä¾›åº”å•†æ²¡æœ‰åæ ‡ä¿¡æ¯
- æœç´¢åŠå¾„å¤ªå°

**è§£å†³:**
```bash
# æ‰¹é‡æ›´æ–°ä¾›åº”å•†åæ ‡
cd backend
python tools/batch_update_locations.py --type SUPPLIER

# æˆ–æ‰©å¤§æœç´¢åŠå¾„
```

### é—®é¢˜ 2: "ç”¨æˆ·æœªå…³è”ç§Ÿæˆ·"

**åŸå› :** å½“å‰ç”¨æˆ·æ²¡æœ‰å…³è”ä¼ä¸š

**è§£å†³:**
1. å®Œæˆä¼ä¸šè®¤è¯
2. ç¡®ä¿ç”¨æˆ·æœ‰ tenant_id

### é—®é¢˜ 3: åœ°ç†ç¼–ç å¤±è´¥

**åŸå› :**
- API Key æ— æ•ˆ
- ç½‘ç»œé—®é¢˜
- åœ°å€æ ¼å¼ä¸æ­£ç¡®

**è§£å†³:**
- æ£€æŸ¥ API Key é…ç½®
- ä½¿ç”¨ç²¾ç¡®çš„åœ°å€æ ¼å¼
- å°è¯•ä½¿ç”¨åæ ‡æœç´¢

### é—®é¢˜ 4: é¡µé¢404

**åŸå› :** è·¯ç”±æœªæ­£ç¡®é…ç½®

**è§£å†³:**
```bash
# ç¡®è®¤è·¯ç”±æ–‡ä»¶å·²æ›´æ–°
cat frontend/src/router/index.js | grep nearby-suppliers

# é‡å¯å‰ç«¯æœåŠ¡
cd frontend
npm run dev
```

---

## ğŸ“ æ•°æ®å‡†å¤‡

### ä¸ºç°æœ‰ä¾›åº”å•†æ·»åŠ åæ ‡

```bash
cd backend

# 1. æŸ¥çœ‹ç»Ÿè®¡
python tools/batch_update_locations.py --stats

# 2. æ‰¹é‡æ›´æ–°ä¾›åº”å•†
python tools/batch_update_locations.py --type SUPPLIER

# 3. éªŒè¯
python tools/batch_update_locations.py --stats
```

### æ‰‹åŠ¨æ·»åŠ æµ‹è¯•ä¾›åº”å•†

```python
from app import create_app
from models import Tenant
from extensions import db

app = create_app()
with app.app_context():
    # åˆ›å»ºæµ‹è¯•ä¾›åº”å•†
    supplier = Tenant(
        name='æµ‹è¯•ä¾›åº”å•†',
        type='SUPPLIER',
        unified_social_credit_code='TEST123456',
        legal_representative='å¼ ä¸‰',
        contact_person='æå››',
        contact_phone='13800138000',
        contact_email='test@example.com',
        address='åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO',
        business_scope='è¯å“æ‰¹å‘',
        longitude=116.470697,
        latitude=40.000565,
        is_active=True
    )
    db.session.add(supplier)
    db.session.commit()
```

---

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### æœç´¢ç•Œé¢

- ç®€æ´çš„æœç´¢è¡¨å•
- ä¸‰ç§æœç´¢æ–¹å¼åˆ‡æ¢
- å®æ—¶æ˜¾ç¤ºæˆ‘çš„ä½ç½®ä¿¡æ¯
- çµæ´»çš„æœç´¢å‚æ•°é…ç½®

### ç»“æœå±•ç¤º

- æ¸…æ™°çš„è¡¨æ ¼å±•ç¤º
- æŒ‰è·ç¦»æ’åº
- è·ç¦»æ ‡ç­¾ï¼ˆé¢œè‰²åŒºåˆ†ï¼‰
- å¿«é€Ÿæ“ä½œæŒ‰é’®

### ä¾›åº”å•†è¯¦æƒ…

- å®Œæ•´çš„ä¼ä¸šä¿¡æ¯
- è”ç³»æ–¹å¼
- ç»è¥èŒƒå›´
- åœ°ç†ä½ç½®

---

## âœ… åŠŸèƒ½æ¸…å•

- [x] é«˜å¾·åœ°å›¾ API é›†æˆ
- [x] åœ°ç†ç¼–ç ï¼ˆåœ°å€â†’åæ ‡ï¼‰
- [x] è·ç¦»è®¡ç®—ï¼ˆç›´çº¿ + é©¾è½¦ï¼‰
- [x] å°±è¿‘ä¾›åº”å•†æ¨è
- [x] REST API æ¥å£
- [x] å‰ç«¯é¡µé¢ç»„ä»¶
- [x] è·¯ç”±é…ç½®
- [x] æ‰¹é‡æ›´æ–°å·¥å…·
- [x] æµ‹è¯•è„šæœ¬
- [x] æ–‡æ¡£è¯´æ˜

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **åœ°å›¾å¯è§†åŒ–**
   - é›†æˆåœ°å›¾ç»„ä»¶æ˜¾ç¤ºä¾›åº”å•†ä½ç½®
   - æ ‡æ³¨è¯åº—å’Œä¾›åº”å•†çš„ä½ç½®ç‚¹

2. **ç­›é€‰åŠŸèƒ½**
   - æŒ‰ç»è¥èŒƒå›´ç­›é€‰
   - æŒ‰è¯„åˆ†æ’åº

3. **æ”¶è—åŠŸèƒ½**
   - æ”¶è—å¸¸ç”¨ä¾›åº”å•†
   - å¿«é€Ÿè®¿é—®

4. **å†å²è®°å½•**
   - ä¿å­˜æœç´¢å†å²
   - å¿«é€Ÿé‡å¤æœç´¢

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- `backend/docs/nearby_feature_part1_testing.md` - ç¬¬ä¸€éƒ¨åˆ†æµ‹è¯•æŒ‡å—
- `backend/docs/nearby_feature_part2_api.md` - ç¬¬äºŒéƒ¨åˆ† API æ–‡æ¡£
- `backend/docs/DATABASE_MIGRATION_GUIDE.md` - æ•°æ®åº“è¿ç§»æŒ‡å—

---

**ğŸŠ æ­å–œï¼å°±è¿‘ä¾›åº”å•†æ¨èåŠŸèƒ½å·²å…¨éƒ¨å®Œæˆï¼**
