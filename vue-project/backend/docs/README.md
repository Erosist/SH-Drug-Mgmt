# åç«¯æ¥å£æ–‡æ¡£ç›®å½•ç»“æ„

## ç›®å½•è¯´æ˜

### `/backend/docs/` - æ–‡æ¡£æ ¹ç›®å½•

#### ğŸ“ `api/` - APIè§„èŒƒæ–‡ä»¶
- **`openapi.yaml`** - OpenAPI 3.0 è§„èŒƒæ–‡ä»¶ï¼Œ**ä¸“æ³¨ä¾›åº”ä¿¡æ¯å‘å¸ƒåŠŸèƒ½**
  - ğŸ¯ **æ ¸å¿ƒåŠŸèƒ½**ï¼šä¾›åº”ä¿¡æ¯å‘å¸ƒç®¡ç† (CRUD)
  - ğŸ” **åŸºç¡€æ”¯æ’‘**ï¼šç”¨æˆ·è®¤è¯æ¥å£ (ç™»å½•ã€è·å–ç”¨æˆ·ä¿¡æ¯)
  - ğŸ’Š **è¾…åŠ©åŠŸèƒ½**ï¼šè¯å“ä¿¡æ¯æŸ¥è¯¢æ¥å£
  - ğŸ“‹ **æ•°æ®è§„èŒƒ**ï¼šç»Ÿä¸€çš„æ•°æ®æ¨¡å‹å’Œé”™è¯¯å“åº”æ ¼å¼

#### ğŸ“ `postman/` - APIæµ‹è¯•é›†åˆ
- **`Supply-Publish-API.postman_collection.json`** - ä¾›åº”ä¿¡æ¯å‘å¸ƒAPIæµ‹è¯•é›†åˆ
  - ğŸ¯ ä¸“æ³¨ä¾›åº”ä¿¡æ¯å‘å¸ƒæ ¸å¿ƒä¸šåŠ¡æµç¨‹
  - ğŸ“‹ åŒ…å«å®Œæ•´çš„å‘å¸ƒã€ç®¡ç†ã€æŸ¥è¯¢æ¥å£æµ‹è¯•
  - ğŸ”§ é¢„è®¾è¯·æ±‚å‚æ•°å’ŒçœŸå®ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹
  - ğŸŒ æ”¯æŒå¤šç¯å¢ƒå˜é‡å’Œè‡ªåŠ¨åŒ–æµ‹è¯•

- **`dev-environment.postman_environment.json`** - å¼€å‘ç¯å¢ƒé…ç½®
  - æœ¬åœ°å¼€å‘æœåŠ¡å™¨é…ç½® (localhost:5000)
  - Tokenå˜é‡å ä½ç¬¦
  - å…¶ä»–ç¯å¢ƒå˜é‡

## ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹APIè§„èŒƒ
```bash
# ä½¿ç”¨ä»»ä½•æ”¯æŒOpenAPIçš„å·¥å…·æ‰“å¼€
# æ¨èå·¥å…·ï¼šSwagger UIã€Redocã€ApiPostã€ApiFox
docs/api/openapi.yaml
```

### 2. å¯¼å…¥Postman/ApiFox
1. å¯¼å…¥é›†åˆæ–‡ä»¶ï¼š`docs/postman/Supply-Publish-API.postman_collection.json`
2. å¯¼å…¥ç¯å¢ƒæ–‡ä»¶ï¼š`docs/postman/dev-environment.postman_environment.json`
3. é€‰æ‹©å¯¹åº”ç¯å¢ƒè¿›è¡Œæµ‹è¯•

### 3. è·å–Tokenè¿›è¡Œæµ‹è¯•

#### ğŸ” ä»€ä¹ˆæ˜¯ç™»å½•ï¼Ÿ
è¿™é‡Œçš„"ç™»å½•"æ˜¯æŒ‡**æ¨¡æ‹Ÿç”¨æˆ·åœ¨è½¯ä»¶ä¸­çš„ç™»å½•è¿‡ç¨‹**ï¼Œä½†æ˜¯é€šè¿‡APIæ¥å£æ¥å®ç°ï¼š
- ğŸ­ **æ¨¡æ‹Ÿç”¨æˆ·èº«ä»½**ï¼šå°±åƒç”¨æˆ·åœ¨ç½‘é¡µæˆ–APPä¸­è¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½•ä¸€æ ·
- ğŸ”‘ **è·å–è®¿é—®æƒé™**ï¼šç™»å½•æˆåŠŸåè·å¾—Tokenï¼ˆä¸´æ—¶é€šè¡Œè¯ï¼‰
- ğŸšª **è¿›å…¥ç³»ç»Ÿ**ï¼šæœ‰äº†Tokenæ‰èƒ½è®¿é—®å…¶ä»–éœ€è¦èº«ä»½éªŒè¯çš„åŠŸèƒ½

#### ğŸ“‹ å…·ä½“æ“ä½œæ­¥éª¤

**ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡**
```bash
# ç¡®ä¿åç«¯æœåŠ¡å·²è¿è¡Œ
cd backend
python run.py
# çœ‹åˆ° "Running on http://127.0.0.1:5000" è¡¨ç¤ºæœåŠ¡å¯åŠ¨æˆåŠŸ
```

**ç¬¬äºŒæ­¥ï¼šè°ƒç”¨ç™»å½•æ¥å£è·å–Token**

**æ–¹æ³•A - ä½¿ç”¨ApiFox/Postmanï¼ˆæ¨èï¼‰**
1. å¯¼å…¥æµ‹è¯•é›†åˆå’Œç¯å¢ƒæ–‡ä»¶ï¼ˆè§ä¸Šé¢å¯¼å…¥æ­¥éª¤ï¼‰
2. é€‰æ‹©"ğŸ” èº«ä»½è®¤è¯ (åŸºç¡€æ”¯æ’‘)" â†’ "ç”¨æˆ·ç™»å½•"æ¥å£
3. è¯·æ±‚ä½“å·²é¢„è®¾å¥½ï¼š
   ```json
   {
     "username": "supplier1",
     "password": "password123"
   }
   ```
4. ç‚¹å‡»"å‘é€"æŒ‰é’®
5. æˆåŠŸåä¼šè¿”å›ï¼š
   ```json
   {
     "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
     "user": {
       "id": 1,
       "username": "supplier1",
       "role": "supplier"
     }
   }
   ```
6. **é‡è¦**ï¼šå¤åˆ¶ `access_token` çš„å€¼ï¼Œè®¾ç½®åˆ°ç¯å¢ƒå˜é‡ `token` ä¸­

**æ–¹æ³•B - ä½¿ç”¨curlå‘½ä»¤**
```bash
# Windows PowerShell
curl -X POST http://localhost:5000/api/auth/login `
  -H "Content-Type: application/json" `
  -d '{"username": "supplier1", "password": "password123"}'

# æˆ–è€…ä½¿ç”¨Invoke-RestMethod
$response = Invoke-RestMethod -Uri "http://localhost:5000/api/auth/login" `
  -Method POST -ContentType "application/json" `
  -Body '{"username": "supplier1", "password": "password123"}'
echo $response.access_token
```

**ç¬¬ä¸‰æ­¥ï¼šåœ¨åç»­æ¥å£ä¸­ä½¿ç”¨Token**
- **ApiFox/Postman**ï¼šTokenä¼šè‡ªåŠ¨åº”ç”¨åˆ°å…¶ä»–æ¥å£çš„Authorizationå¤´
- **æ‰‹åŠ¨æµ‹è¯•**ï¼šåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `Authorization: Bearer {ä½ çš„token}`

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼šä¾›åº”ä¿¡æ¯å‘å¸ƒ

### ğŸ“‹ å®Œæ•´ä¸šåŠ¡æµç¨‹
```
ğŸ” èº«ä»½è®¤è¯
1. POST /api/auth/login        â†’ ä¾›åº”å•†ç™»å½•è·å–æƒé™

ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼šä¾›åº”ä¿¡æ¯å‘å¸ƒ
2. GET  /api/supply/drugs      â†’ é€‰æ‹©è¦ä¾›åº”çš„è¯å“
3. POST /api/supply/info       â†’ ğŸŒŸ å‘å¸ƒä¾›åº”ä¿¡æ¯ (æ ¸å¿ƒ)
4. GET  /api/supply/info       â†’ æŸ¥çœ‹æˆ‘çš„ä¾›åº”ä¿¡æ¯
5. PUT  /api/supply/info/{id}  â†’ æ›´æ–°ä¾›åº”ä¿¡æ¯
6. DELETE /api/supply/info/{id} â†’ ä¸‹æ¶ä¾›åº”ä¿¡æ¯

ğŸ” ç®¡ç†ç›‘æ§  
7. GET  /api/auth/me           â†’ æŸ¥çœ‹å½“å‰ç™»å½•çŠ¶æ€
8. GET  /api/supply/info/{id}  â†’ æŸ¥çœ‹ä¾›åº”ä¿¡æ¯è¯¦æƒ…
```

### ğŸš€ å¿«é€Ÿä¸Šæ‰‹ï¼š5åˆ†é’Ÿå‘å¸ƒä¾›åº”ä¿¡æ¯
```
ç¬¬1æ­¥ï¼šç™»å½•ç³»ç»Ÿ (30ç§’)
ç¬¬2æ­¥ï¼šé€‰æ‹©è¯å“ (1åˆ†é’Ÿ)  
ç¬¬3æ­¥ï¼šå¡«å†™ä¾›åº”ä¿¡æ¯ (2åˆ†é’Ÿ)
ç¬¬4æ­¥ï¼šå‘å¸ƒæˆåŠŸ (30ç§’)
ç¬¬5æ­¥ï¼šæŸ¥çœ‹æ•ˆæœ (1åˆ†é’Ÿ)
```

## ğŸ¯ è®¾è®¡ç†å¿µï¼šä¸“æ³¨æ ¸å¿ƒä¸šåŠ¡ä»·å€¼

### ğŸ’¡ ä¸ºä»€ä¹ˆä¸“æ³¨äº"ä¾›åº”ä¿¡æ¯å‘å¸ƒ"ï¼Ÿ

#### âœ… **ä¸šåŠ¡èšç„¦çš„ä¼˜åŠ¿**
1. **ğŸ¯ ç”¨æˆ·ä»·å€¼æ˜ç¡®**ï¼šä¾›åº”å•†çš„æ ¸å¿ƒéœ€æ±‚å°±æ˜¯å‘å¸ƒä¾›åº”ä¿¡æ¯
2. **ğŸš€ å¼€å‘æ•ˆç‡é«˜**ï¼šé¿å…åŠŸèƒ½è‡ƒè‚¿ï¼Œå¿«é€Ÿäº¤ä»˜æ ¸å¿ƒä»·å€¼
3. **ğŸ”§ ç»´æŠ¤æˆæœ¬ä½**ï¼šåŠŸèƒ½è¾¹ç•Œæ¸…æ™°ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
4. **ğŸ“ˆ è¿­ä»£é€Ÿåº¦å¿«**ï¼šä¸“æ³¨ä¼˜åŒ–æ ¸å¿ƒåŠŸèƒ½çš„ç”¨æˆ·ä½“éªŒ

#### ğŸ—ï¸ **æ¶æ„è®¾è®¡åŸåˆ™**
```
ğŸ¯ æ ¸å¿ƒå±‚ï¼šä¾›åº”ä¿¡æ¯å‘å¸ƒ (80%çš„å¼€å‘èµ„æº)
â”œâ”€â”€ ğŸ“ ä¿¡æ¯å½•å…¥ä¼˜åŒ–
â”œâ”€â”€ ğŸ” ä¿¡æ¯å±•ç¤ºä¼˜åŒ–  
â””â”€â”€ âš¡ å‘å¸ƒæµç¨‹ä¼˜åŒ–

ğŸ”§ æ”¯æ’‘å±‚ï¼šåŸºç¡€åŠŸèƒ½ (20%çš„å¼€å‘èµ„æº)
â”œâ”€â”€ ğŸ” èº«ä»½è®¤è¯
â”œâ”€â”€ ğŸ’Š è¯å“æ•°æ®
â””â”€â”€ ğŸ“Š åŸºç¡€ç›‘æ§
```

#### ğŸ”® **æœªæ¥æ‰©å±•è·¯å¾„**
- **Phase 1**: ä¾›åº”ä¿¡æ¯å‘å¸ƒ (å½“å‰) âœ…
- **Phase 2**: è®¢å•æ¥æ”¶å¤„ç†
- **Phase 3**: åº“å­˜åŒæ­¥ç®¡ç†
- **Phase 4**: æ•°æ®åˆ†ææŠ¥è¡¨

## å¼€å‘å»ºè®®

### API-First å¼€å‘æµç¨‹
1. **è®¾è®¡é˜¶æ®µ**ï¼šä¿®æ”¹ `openapi.yaml` è§„èŒƒï¼Œä¼˜å…ˆè®¾è®¡æ ¸å¿ƒå‘å¸ƒåŠŸèƒ½
2. **å‰ç«¯å¼€å‘**ï¼šåŸºäºè§„èŒƒå¼€å‘ä¾›åº”ä¿¡æ¯å‘å¸ƒç•Œé¢  
3. **åç«¯å¼€å‘**ï¼šåŸºäºè§„èŒƒå®ç°æ ¸å¿ƒå‘å¸ƒæ¥å£
4. **é›†æˆæµ‹è¯•**ï¼šä½¿ç”¨Postman/ApiFoxéªŒè¯å‘å¸ƒæµç¨‹

### æµ‹è¯•æ•°æ®
ç³»ç»ŸåŒ…å«ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

#### ğŸ‘¥ æµ‹è¯•ç”¨æˆ·è´¦å·
- **ä¾›åº”å•†ç”¨æˆ·**ï¼š`supplier1` / `password123`
- **è¯æˆ¿ç”¨æˆ·**ï¼š`pharmacy1` / `password123`
- **ç‰©æµç”¨æˆ·**ï¼š`logistics1` / `password123`
- **ç›‘ç®¡ç”¨æˆ·**ï¼š`regulator1` / `password123`
- **ç®¡ç†å‘˜ç”¨æˆ·**ï¼š`admin` / `admin123`

#### ğŸ’Š æµ‹è¯•è¯å“æ•°æ®
- é˜¿è«è¥¿æ—èƒ¶å›Š (0.25g)
- å¸ƒæ´›èŠ¬ç‰‡ (0.2g)
- å¤´å­¢å…‹è‚Ÿèƒ¶å›Š (0.1g)

#### ğŸ¢ æµ‹è¯•ä¼ä¸šæ•°æ®
- ä¸Šæµ·åŒ»è¯é›†å›¢è‚¡ä»½æœ‰é™å…¬å¸ (ä¾›åº”å•†)
- åæ¶¦åŒ»è¯æ§è‚¡æœ‰é™å…¬å¸ (ä¾›åº”å•†)
- ä¸Šæµ·ç‘é‡‘åŒ»é™¢è¯æˆ¿ (è¯æˆ¿)
- é¡ºä¸°åŒ»è¯ç‰©æµ (ç‰©æµ)
- ä¸Šæµ·å¸‚è¯ç›‘å±€ (ç›‘ç®¡æœºæ„)

### æƒé™è¯´æ˜
- **ä¾›åº”å•†ç”¨æˆ·**ï¼šåªèƒ½ç®¡ç†è‡ªå·±ä¼ä¸šçš„ä¾›åº”ä¿¡æ¯
- **ç®¡ç†å‘˜ç”¨æˆ·**ï¼šå¯ä»¥ç®¡ç†æ‰€æœ‰ä¾›åº”ä¿¡æ¯
- **å…¶ä»–è§’è‰²**ï¼šåªèƒ½æŸ¥çœ‹ä¾›åº”ä¿¡æ¯

## ğŸ§ª ä¸“æ³¨åŠŸèƒ½æµ‹è¯•ç¤ºä¾‹

### ğŸ¯ æ ¸å¿ƒåœºæ™¯ï¼šä¾›åº”å•†å‘å¸ƒè¯å“ä¾›åº”ä¿¡æ¯
> **ä¸šåŠ¡ä»·å€¼**ï¼šå¸®åŠ©ä¾›åº”å•†å¿«é€Ÿã€ä¾¿æ·åœ°å‘å¸‚åœºå‘å¸ƒè¯å“ä¾›åº”ä¿¡æ¯ï¼Œå®ç°ä¾›éœ€å¯¹æ¥

**æ­¥éª¤1ï¼šç™»å½•è·å–Token**
```http
POST http://localhost:5000/api/auth/login
Content-Type: application/json

{
  "username": "supplier1",
  "password": "password123"
}
```
**è¿”å›ç»“æœï¼š**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "user": {
    "id": 1,
    "username": "supplier1",
    "role": "supplier",
    "tenant": {
      "name": "ä¸Šæµ·åŒ»è¯é›†å›¢è‚¡ä»½æœ‰é™å…¬å¸"
    }
  }
}
```

**æ­¥éª¤2ï¼šæŸ¥çœ‹å¯é€‰æ‹©çš„è¯å“**
```http
GET http://localhost:5000/api/supply/drugs
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
```

**æ­¥éª¤3ï¼šå‘å¸ƒä¾›åº”ä¿¡æ¯**
```http
POST http://localhost:5000/api/supply/info
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
Content-Type: application/json

{
  "drug_id": 1,
  "available_quantity": 1000,
  "unit_price": 25.50,
  "min_order_quantity": 50,
  "valid_until": "2025-12-31",
  "description": "ä¼˜è´¨é˜¿è«è¥¿æ—ï¼Œç°è´§å……è¶³"
}
```

**æ­¥éª¤4ï¼šæŸ¥çœ‹å‘å¸ƒçš„ä¾›åº”ä¿¡æ¯**
```http
GET http://localhost:5000/api/supply/info
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
```

### âš ï¸ å¸¸è§é—®é¢˜

**Q1: ç™»å½•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**
- æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- ç¡®è®¤åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²åˆå§‹åŒ–

**Q2: Tokenè¿‡æœŸæ€ä¹ˆåŠï¼Ÿ**
- é‡æ–°è°ƒç”¨ç™»å½•æ¥å£è·å–æ–°Token
- Tokené»˜è®¤2å°æ—¶æœ‰æ•ˆæœŸ

**Q3: æ¥å£è¿”å›401æœªæˆæƒï¼Ÿ**
- æ£€æŸ¥æ˜¯å¦å·²è®¾ç½®Authorizationå¤´
- ç¡®è®¤Tokenæ ¼å¼ï¼š`Bearer {token}`
- éªŒè¯Tokenæ˜¯å¦å·²è¿‡æœŸ

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æ¥å£
1. åœ¨ `openapi.yaml` ä¸­å®šä¹‰æ–°æ¥å£
2. æ›´æ–° Postman é›†åˆæ–‡ä»¶
3. å®ç°å¯¹åº”çš„åç«¯ä»£ç 
4. æ·»åŠ å‰ç«¯è°ƒç”¨ä»£ç 

### å¤šç¯å¢ƒæ”¯æŒ
å¯åˆ›å»ºæ›´å¤šç¯å¢ƒæ–‡ä»¶ï¼š
- `test-environment.postman_environment.json` (æµ‹è¯•ç¯å¢ƒ)
- `prod-environment.postman_environment.json` (ç”Ÿäº§ç¯å¢ƒ)
