# .gitlab-ci.yml
# 【V7 修复版】我们（pytest）在 backend 文件夹*里面*运行

stages:
  - test

test-backend:
  stage: test
  tags:
    - SH-Drug-Mgmt

  # （关键！）我们*进入* 'backend' 并且*待在*里面
  before_script:
    - cd vue-project
    - cd backend  # <-- 我们进入 'backend'
    - echo "我现在在 'backend' 文件夹里, 开始安装..."
    - pip install -r requirements.txt
    - pip install pytest pytest-flask pytest-mock

  script:
    - echo "我正在 'backend' 文件夹里*直接*运行 pytest..."
    # （我们不再需要 $env:PYTHONPATH 了，因为我们就在 'backend' 里）
    - pytest # <-- 就运行 pytest。它会自动找到 'tests/'
             #     并且 'app.py' 也能找到 'config.py' 了！

test-frontend:
  stage: test
  tags:
    - SH-Drug-Mgmt

  before_script:
    - cd vue-project
    - npm install
  script:
    - npm run test